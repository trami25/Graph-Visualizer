<head>
    <link rel="stylesheet" type="text/css" href="../../static/styles.css">
    <script src="https://d3js.org/d3.v7.min.js"></script>
</head>
<body>
    <div class="graph-container">
        {% for node in graph.nodes %}
            <p class="node" id="node{{ node.node_id }}">ID: {{ node.node_id }}</p>
        {% endfor %}
        <svg id="graph-svg"></svg>
    </div>

     <script>
        var width = 800;
        var height = 600;

        var svg = d3.select("#graph-svg")
            .attr("width", width)
            .attr("height", height);

        let nodes = JSON.parse('{{ graph.nodes|tojson|safe }}');
        let edges = JSON.parse('{{ graph.edges|tojson|safe }}');
        let graph_directed = true;

        var simulation = d3.forceSimulation(nodes)
            .force("charge", d3.forceManyBody().strength(-200))
            .force("link", d3.forceLink(edges).id(d => d.node_id))
            .force("center", d3.forceCenter(width / 2, height / 2));

        var link = svg.selectAll("line")
            .data(edges)
            .enter().append("line")
            .attr("marker-end", d => graph_directed ? "url(#arrow)" : "");

        var node = svg.selectAll("circle")
            .data(nodes)
            .enter().append("circle")
            .attr("r", 10)
            .style("fill", "blue");

        simulation.on("tick", function() {
            link.attr("x1", d => d.source.x)
                .attr("y1", d => d.source.y)
                .attr("x2", d => d.target.x)
                .attr("y2", d => d.target.y);

            node.attr("cx", d => d.x)
                .attr("cy", d => d.y);
        });

        var text = svg.selectAll("text")
            .data(nodes)
            .enter().append("text")
            .attr("x", d => d.x)
            .attr("y", d => d.y)
            .text(d => "ID: " + d.node_id)
            .style("font-size", "8px")
            .style("fill", "black");

        svg.append("defs").append("marker")
        .attr("id", "arrow")
        .attr("viewBox", "0 -5 10 10")
        .attr("refX", 8)
        .attr("refY", 0)
        .attr("markerWidth", 8)
        .attr("markerHeight", 8)
        .attr("orient", "auto")
        .append("path")
        .attr("d", "M0,-5L10,0L0,5");

    </script>
</body>
